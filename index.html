<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>jeuStations</title>
    <style type="text/css" media="screen">
        canvas, img { display:block; margin:1em auto; border:1px solid black; }
        canvas { background:url('content/carte.jpg') }
    </style>
</head>
<body>

<canvas id="carte_ratp" width="810" height="808">
    L'objet Canvas ne marche pas chez vous, veuillez utiliser un navigateur r√©cent.
</canvas>

<input type="text" name="subject" id="subject" onkeyup="refreshAC()"  />
<div id="result" style="margin-left: 3px;width: 150px;border-left: solid black 1px;border-right: solid black 1px;border-bottom: solid black 1px;"  ></div>

<script>
    var canvas = document.getElementById('carte_ratp');
    var context = canvas.getContext('2d');
    var xhr = getXMLHttpRequest();
    var stations;
    var res = document.getElementById("result");
    window.onload = function()
    {
        xhr.open("GET", "ChargementStations.php" , true);
        xhr.send(null);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && (xhr.status == 200 || xhr.status == 0)) {
                stations = JSON.parse(xhr.responseText);
                var item = stations[1];
                stations.forEach(function(station){
                    if(station.type == 'metro'){
                        drawCircle(canvas, station.x, station.y);
                    }

                })

            }
        };
    }

    /**
     * Charge l'objet HttpRequest
     */

    function getXMLHttpRequest() {
        var xhr = null;
        if (window.XMLHttpRequest || window.ActiveXObject) {
            if (window.ActiveXObject) {
                try {
                    xhr = new ActiveXObject("Msxml2.XMLHTTP");
                } catch(e) {
                    xhr = new ActiveXObject("Microsoft.XMLHTTP");
                }
            } else {
                xhr = new XMLHttpRequest();
            }
        } else {
            alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest...");
            return null;
        }

        return xhr;
    }

    /**
     * Draw a circle at a specific location within the canvas
     * @param x
     * @param y
     */
    function drawCircle(canvas, x, y, name){
        var RESIZE = 10;
        var RADIUS = 8;

        context.beginPath();
        context.arc(x/RESIZE, y/RESIZE, RADIUS, 0, 2 * Math.PI, false);
        context.fillStyle = 'red';
        context.fill();
        context.stroke();
        // console.log(name);

        context.font = "bold 16px Arial";
        context.fillText(name, x, y);
    }

    function drawText(name, x, y){
        var RESIZE = 10;
        context.font = "bold 8px Arial";
        context.fillStyle = 'black';
        context.fillText(name, x/RESIZE, y/RESIZE);
    }

    /**
     *
     * @param tab
     * @returns {number}
     */
    function random( tab )
    {
        var n = Math.floor(tab.length * Math.random());
        return n;
    }

    /**
     * Refresh the autocomplete
     */
    function refreshAC()
    {

        var sub = document.getElementById("subject");
        var val = sub.value;

        res.innerHTML = "";
        if( val != "" )
        {
            stations.forEach(function(station){
                if(station.type =='metro'){
                    var rgxp = new RegExp('^'+val, "g");
                    if(station.name.match(rgxp) != null && station.name.match(rgxp).length){

                        res.innerHTML += "<div id='element' onmouseout='selectionPointer2(this)' onmouseover='selectionPointer(this)' onclick='selectionClique(this.innerHTML)'>"+station.name+"</div>";

                    }
                }
            });
        }
    }

    function selectionPointer2( id )
    {
        id.style.backgroundColor = "white";
    }
    function selectionPointer( id )
    {
        id.style.backgroundColor = "green";
    }
    function selectionClique( txt )
    {
        var sub = document.getElementById("subject");
        sub.value = txt;
        res.innerHTML = "";
    }

</script>
</body>
</html>